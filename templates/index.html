<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Api Filmes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>


   <div class="container">
      <h2>Todos os Filmes - /filmes GET</h2>

      <table class="table">
         <thead >
               <tr>
               <th >Filme</th>
               <th >Ano Lançamento</th>
               </tr>
            </thead>
            <tbody >
               {% for filme in filmes %}
               <tr>
                  <td > {{filme.movie_name}} </td>
                  <td > {{filme.movie_year}} </td>
               </tr>
               {% endfor %}
            </tbody>
      </table>
      <button type="button" class="btn btn-info" id="btn-todos">Todos os Filmes</button>
      <br>
                  
   </div>






   <div class="container">
      <div class="row">
         <div class="col">
            <h2>Consulta de Filme por ID</h2>
            <form>
                  <div class="form-group">
                     <label for="id">ID</label>
                     <input type="text" class="form-control" maxlength="9" id="id">
                     <small>Integer ID</small>
                     <br>
                     <button type="button" class="btn btn-info" id="btn-por-id">Consulta filme por ID</button>
                  </div>
                  <div class="form-group">
                     <label for="nome">Nome</label>
                     <input type="text" class="form-control" id="movie_name">
                     <small>movie_name</small>
                  </div>
                  <div class="form-group">
                     <label for="ano">Ano</label>
                     <input type="text" class="form-control" id="movie_year">
                     <small>movie_year</small>
                  </div>
            </form>
         </div>

         <div class="col">
            <h2>Inserir Novo Filme</h2>



            <form>
                  <div class="form-group">
                     <label for="nome_ins">Nome</label>
                     <input type="text" class="form-control" id="movie_name_ins">
                  </div>
                  <div class="form-group">
                     <label for="ano_ins">Ano</label>
                     <input type="text" class="form-control" id="movie_year_ins">
                  </div>
                  <button type="button" class="btn btn-info" id="btn-insere-filme">Insere Filme</button>
            </form>



         </div>
      </div>
   </div>



<script>
      const id_text_field = document.querySelector("#id")
      const botao_filme_por_id = document.querySelector("#btn-por-id")

      const showData = (result)=>{
         if(result === 'null'){
            document.querySelector("#movie_name").value = "Não encontrado";
            document.querySelector("#movie_year").value = "Não encontrado";
            alert("Não encontrado");
         }else{
            //console.log(result);
            for(const campo in result){
               if(document.querySelector("#"+campo)){
                     document.querySelector("#"+campo).value = result[campo]
               }
            }
         }
      }

      botao_filme_por_id.addEventListener("click",(e)=>{
         let search = id_text_field.value
         const options = {
            method: 'GET',
            mode: 'cors',
            cache: 'default'
         }

         fetch(`/filmes/${search}`, options)
         .then(response =>{ response.json()
            .then( data => showData(data))
         })
         .catch(e => console.log('Deu Erro: '+ e,message))
      })

      const botao_todos = document.querySelector("#btn-todos")
      botao_todos.addEventListener("click",(e)=>{

         document.location.reload(true);
      })







</script>


</body>
</html>